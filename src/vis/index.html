<!doctype html>
<html>
<head>
<meta charset="utf-8">

<title>AST visualizer</title>

<link rel="stylesheet" href="css/vtree.css" type="text/css"/>

<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="dist/vtree.js"></script>

<script>

function handleFileSelect(evt) {
    evt.stopPropagation();
    evt.preventDefault();
    var files = evt.dataTransfer.files; // FileList object.
    // files is a FileList of File objects. List some properties.
    var output = [];
    for (var i = 0, f; f = files[i]; i++) {
      
      function process_ast(e) {
      let lines = e.target.result;
      document.getElementById("from-text").value=lines;   
    }
    fr = new FileReader();
      fr.onload = process_ast;
      fr.readAsText(f); 
    }
  
  }
function handleDragOver(evt) {
    evt.stopPropagation();
    evt.preventDefault();
    evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
  }
</script>
<script type="text/javascript">
var vt;

window.onload = function () {
  var container = document.getElementById("container");
  var msg = document.getElementById("msg");
  vt = new VTree(container);
  var reader = new VTree.reader.Object();

  function updateTree() {
    var s = document.getElementById("from-text").value;

    msg.innerHTML = '';

    try {
      var jsonData = JSON.parse(s);
    } catch (e) {
      msg.innerHTML = 'Please input an AST';
    }

    var data = reader.read(jsonData);

    vt.data(data)
      .update();
  }


  document.getElementById("go-button").onclick = updateTree;

  updateTree();
};

</script>

</head>

<body>
  <div class="container">

    <h1>AST visualizer</h1>
    
    <div id="drop_zone">Drop files here</div>
    <output id="astfiles"></output>
    <div style="margin-top: 1em;">
      <label for="from-text">JSON</label><br>
      <textarea id="from-text" rows="6" cols="80"></textarea>
    </div>

    <div style="margin-top: 1em;">
      <input id="go-button" type="button" value="Visualize">
    </div>

    <div id="msg" style="color: black;"></div>

    <div id="container"></div>




  </div>

<script>
  
  var dropZone = document.getElementById('drop_zone');
  dropZone.addEventListener('dragover', handleDragOver, false);
  dropZone.addEventListener('drop', handleFileSelect, false);
  </script>
</body>

</html>
